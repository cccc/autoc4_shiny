var A=Object.defineProperty;var w=(r,t,e)=>t in r?A(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var h=(r,t,e)=>w(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();$("body").on("click input change","[data-toggle=value][data-target][data-value],[data-toggle=value][href][data-value]",function(){for(const r of document.querySelectorAll(this.getAttribute("data-target")||this.getAttribute("href")))r.value=this.getAttribute("data-value")||""});$("body").on("click input change","[data-toggle=display][data-target],[data-toggle=display][href]",function(){for(const r of document.querySelectorAll(this.getAttribute("data-target")||this.getAttribute("href")))r.classList.toggle("d-none")});/**
 * @description A simple script adding a "dark" class to the body
 * if certain conditions are met. Can be used for creating a dark
 * mode based on SearchParams, LocalStorage, and the browsers prefered
 * color scheme.
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2019-2020
 * @license MIT
 */((r,t)=>{const e=t("body"),o=r.matchMedia("(prefers-color-scheme: dark)"),s="DARK_THEME_ENABLED";function n(l){o.matches?(e.addClass("dark"),e.removeClass("light")):r.matchMedia("(prefers-color-scheme: light)").matches&&(e.addClass("light"),e.removeClass("dark")),l&&o.addEventListener("change",a)}function i(){o.removeEventListener("change",a)}const a=n.bind(null,!1);try{const l=new URLSearchParams(r.location.search);l.has("dark")||l.has("light")?l.has("dark")?(localStorage.setItem(s,"true"),e.addClass("dark"),e.removeClass("light")):l.get("light")&&(localStorage.setItem(s,"false"),e.addClass("light"),e.removeClass("dark")):localStorage.getItem(s)!==null?localStorage.getItem(s)==="true"?(e.addClass("dark"),e.removeClass("light")):(e.addClass("light"),e.removeClass("dark")):n(!0)}catch{n(!0)}t(()=>{e.on("click","[data-toggle=theme]",l=>{l.preventDefault();try{localStorage.setItem("DARK_THEME_ENABLED",localStorage.getItem("DARK_THEME_ENABLED")==="true"?"false":"true"),e.toggleClass("dark"),e.toggleClass("light"),i()}catch{const c=new URLSearchParams(r.location.search);e.hasClass("dark")?(c.delete("dark"),c.set("light","")):(c.delete("light"),c.set("dark","")),r.location.search=c.toString()}})})})(window,jQuery);/**
 * @description A joke module which activates the cyber mode when
 * a certain key sequence is pressed or a certain topic gets activated.
 * This is primarily intended to react to the Konami Code and the cyber
 * alert topic but can in theory add any class to any element upon
 * activation of any topic.
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2019-2020
 * @license MIT
 */let C=class{constructor(t,e){h(this,"options");if(this.options=e,this.options.keys){let o=0;document.addEventListener("keydown",s=>{o=s.keyCode===this.options.keys[o]?o+1:0,o===this.options.keys.length&&(this.toggle(),o=0)})}}toggle(t){const e=document.querySelectorAll(this.options.target);for(const o of e)o.classList.toggle(this.options.class,t)}onMessage(t,e){e.payloadBytes[0]?this.toggle(!0):this.toggle(!1)}};function _(r,t){return new C(r,t)}/**
 * @description A simple module defining a utility class for simple RGB/HSV color conversion
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2019-2020
 * @license MIT
 */class f{constructor(){h(this,"_h",0);h(this,"_s",0);h(this,"_v",0);h(this,"_r",0);h(this,"_g",0);h(this,"_b",0);this.rgb={r:0,g:0,b:0}}get h(){return this._h}set h(t){this._h=t,this.updateRGB()}get s(){return this._s}set s(t){this._s=t,this.updateRGB()}get v(){return this._v}set v(t){this._v=t,this.updateRGB()}get hsv(){return{h:this._h,s:this._s,v:this._v}}set hsv(t){this._h=t.h,this._s=t.s,this._v=t.v,this.updateRGB()}get r(){return this._r}set r(t){this._r=t,this.updateHSV()}get g(){return this._g}set g(t){this._g=t,this.updateHSV()}get b(){return this._b}set b(t){this._b=t,this.updateHSV()}get rgb(){return{r:this._r,g:this._g,b:this._b}}set rgb(t){this._r=t.r,this._g=t.g,this._b=t.b,this.updateHSV()}updateHSV(){const t=f.RGBtoHSV(this.rgb);this._h=t.h,this._s=t.s,this._v=t.v}updateRGB(){const t=f.HSVtoRGB(this.hsv);this._r=t.r,this._g=t.g,this._b=t.b}static RGBtoHSV(t){const e=t.g,o=t.b,s=t.r,n=Math.max(s,e,o),i=Math.min(s,e,o),a=n-i;let l=0;switch(n){case i:l=0;break;case s:l=e-o+a*(e<o?6:0),l/=6*a;break;case e:l=o-s+a*2,l/=6*a;break;case o:l=s-e+a*4,l/=6*a;break}const c=n===0?0:a/n,u=n/255;return{h:l,s:c,v:u}}static HSVtoRGB(t){let e;const o=t.h,s=t.s,n=t.v;e=Math.floor(o*6);const i=o*6-e,a=n*(1-s),l=n*(1-i*s),c=n*(1-(1-i)*s);let u=0,d=0,p=0;switch(e%6){case 0:u=n,d=c,p=a;break;case 1:u=l,d=n,p=a;break;case 2:u=a,d=n,p=c;break;case 3:u=a,d=l,p=n;break;case 4:u=c,d=a,p=n;break;case 5:u=n,d=a,p=l;break}return{r:Math.round(u*255),g:Math.round(d*255),b:Math.round(p*255)}}toHexString(){return`#${f.numberToHexString(this._r)}${f.numberToHexString(this._g)}${f.numberToHexString(this._b)}`}static fromRGB(t){const e=new f;return e.rgb=t,e}static fromHSV(t){const e=new f;return e.hsv=t,e}static fromHexString(t){const e=new f;return e.rgb={r:Number.parseInt(t.substring(1,3),16),g:Number.parseInt(t.substring(3,5),16),b:Number.parseInt(t.substring(5,7),16)},e}static numberToHexString(t,e=2){let o=t.toString(16);return o="0".repeat(e-o.length)+o,o}}/**
 * @description A module that allows controlling DMX/RGB lights
 * controlled through AutoC4. It supports 3/4 and 7 channel
 * DMX lights.
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 * @requires color
 */let M=class{constructor(t,e){h(this,"options");h(this,"autoc4");this.options=e,this.autoc4=t,this.initColorSelection(),this.initPoweroff(),this.initBrightness(),this.initFade(),this.initRandom(),this.initSound()}onMessage(t,e){const o=e.destinationName.split("/");if(o.length<3)return;const s=e.payloadBytes;if(s.length<3)return;const n=o[1],i=o[2],a=this.getPickers(n,"light",i);if(!a.length)return;const l=f.fromRGB({r:s[0],g:s[1],b:s[2]}).toHexString();for(const c of a)c.value=l;this.updateMasterForRoom(n)}updateMasterForRoom(t){let e;for(const o of this.getPickers(t))if(e===void 0)e=o.value;else if(e!==o.value){e="#000000";break}e===void 0&&(console.warn(`module/dmx: No color found for room "${t}". Could not update master picker.`),e??(e="#000000"));for(const o of this.getPickers(t,"master"))o.value=e}initColorSelection(){const t=this;$("body").on("change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=light],[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=master]`,function(){const e=f.fromHexString(this.value),o=+(this.getAttribute(t.options.channelsDataAttribute)??7),s=this.getAttribute(t.options.roomDataAttribute);let n=this.getAttribute(t.options.lightDataAttribute);if(!n)if(this.getAttribute(t.options.roleDataAttribute)==="master")n="master";else return;t.setLightColor(s,n,o,e)})}initPoweroff(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=poweroff]`,function(){const e=f.fromRGB({r:0,g:0,b:0}),o=+(this.getAttribute(t.options.channelsDataAttribute)??7),s=this.getAttribute(t.options.roomDataAttribute);let n=this.getAttribute(t.options.lightDataAttribute);n||(n="master"),t.setLightColor(s,n,o,e)})}initBrightness(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=brightness][${this.options.valueDataAttribute}]`,function(){const e=+this.getAttribute(t.options.valueDataAttribute),o=this.getAttribute(t.options.roomDataAttribute);for(const s of t.getPickers(o)){const n=+(s.getAttribute(t.options.channelsDataAttribute)??7),i=s.getAttribute(t.options.lightDataAttribute);if(!i){console.warn(`module/dmx: Color picker is missing "${t.options.lightDataAttribute}" attribute.`,s);continue}const a=f.fromHexString(s.value);a.v=Math.min(Math.max(0,a.v*e),1),t.setLightColor(o,i,n,a)}})}initRandom(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=random][${this.options.valueDataAttribute}]`,function(){const e=Number($(this.getAttribute(t.options.valueDataAttribute)).val()),o=$(this.getAttribute(t.options.roomDataAttribute)).val();if(typeof o!="string"){console.error("module/dmx: Room for random could not be determined.");return}for(const s of t.getPickers(o)){const n=+(s.getAttribute(t.options.channelsDataAttribute)??7),i=s.getAttribute(t.options.lightDataAttribute);if(!i){console.warn(`module/dmx: Color picker is missing "${t.options.lightDataAttribute}" attribute.`,s);continue}const a=f.fromHSV({h:Math.random(),s:1,v:e});t.setLightColor(o,i,n,a)}})}initFade(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=fade][${this.options.valueDataAttribute}]`,function(){const e=Number($(this.getAttribute(t.options.valueDataAttribute)).val()),o=$(this.getAttribute(t.options.roomDataAttribute)).val();if(typeof o!="string"){console.error("module/dmx: Room for fade could not be determined.");return}for(const s of t.getPickers(o)){if(+(s.getAttribute(t.options.channelsDataAttribute)??7)!==7)continue;const i=s.getAttribute(t.options.lightDataAttribute);if(!i){console.warn(`module/dmx: Color picker is missing "${t.options.lightDataAttribute}" attribute.`,s);continue}t.sendLightData(o,i,new Uint8Array([0,0,0,0,e,140,255]))}})}initSound(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=sound][${this.options.valueDataAttribute}]`,function(){const e=Number($(this.getAttribute(t.options.valueDataAttribute)).val()),o=$(this.getAttribute(t.options.roomDataAttribute)).val();if(typeof o!="string"){console.error("module/dmx: Room for sound could not be determined.");return}for(const s of t.getPickers(o)){if(+(s.getAttribute(t.options.channelsDataAttribute)??7)!==7)continue;const i=s.getAttribute(t.options.lightDataAttribute);if(!i){console.warn(`module/dmx: Color picker is missing "${t.options.lightDataAttribute}" attribute.`,s);continue}t.sendLightData(o,i,new Uint8Array([0,0,0,0,e,246,255]))}})}setLightColor(t,e,o,s){o===3?this.sendLightData(t,e,new Uint8Array([s.r,s.g,s.b,255])):this.sendLightData(t,e,new Uint8Array([s.r,s.g,s.b,0,0,0,255]))}sendLightData(t,e,o){this.autoc4.sendData(`dmx/${t}/${e}`,o,!0),this.updateMasterForRoom(t)}getPickers(t,e="light",o){let s;return o===void 0?s=document.querySelectorAll(`[${this.options.roleDataAttribute}="${e}"][${this.options.roomDataAttribute}="${t}"]`):s=document.querySelectorAll(`[${this.options.roleDataAttribute}="${e}"][${this.options.roomDataAttribute}="${t}"][${this.options.lightDataAttribute}="${o}"]`),Array.prototype.slice.apply(s)}};function D(r,t){return new M(r,t)}/**
 * @description This module looks for the actication of a range of topics and adds them
 * into a list monitoring the activation/deactivation and displaying the current state.
 * This primarily used for monitoring the state of infrastructure(running/dead) that is
 * part of AutoC4.
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let S=class{constructor(){h(this,"heartbeats",{})}onMessage(t,e){const o=e.destinationName.substring(10);o in this.heartbeats||(this.heartbeats[o]=this.createEntry(o),$("#infrastructure-table").append(this.heartbeats[o].element)),e.payloadBytes.length||(this.heartbeats[o].element.remove(),delete this.heartbeats[o]),e.payloadBytes[0]?this.heartbeats[o].state_icon.addClass("fa-thumbs-up").removeClass("fa-thumbs-down"):this.heartbeats[o].state_icon.addClass("fa-thumbs-down").removeClass("fa-thumbs-up")}createEntry(t){const e={element:$("<tr>").append($("<td>").addClass("heartbeat-name").text(t)),state_icon:$("<i>").addClass("heartbeat-state-icon fa").attr("data-heartbeat-name",t)};return e.element.append($("<td>").addClass("heartbeat-state").append(e.state_icon)),e}};function x(r,t){return new S}/**
 * @description A simple module for defining data attributes for elements
 * such that when there is any user interaction with the element an MQTT
 * message is sent.
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2019-2020
 * @license MIT
 */let T=class{constructor(t,e){h(this,"autoc4");h(this,"options");this.options=e,this.autoc4=t;const o=this;$("body").on("click change input",`[${this.options.mqttTopicDataAttibute}]`,function(s){s.preventDefault();const n=this.getAttribute(o.options.mqttTopicDataAttibute);if(!n)return;const i=!!this.getAttribute(o.options.mqttRetainedDataAttribute);this.hasAttribute(o.options.mqttMessageDataAttribute)?o.autoc4.sendData(n,this.getAttribute(o.options.mqttMessageDataAttribute),i):this.hasAttribute(o.options.mqttByteMessageDataAttribute)?o.autoc4.sendByte(n,Number(this.getAttribute(o.options.mqttByteMessageDataAttribute)),i):o.autoc4.sendByte(n,0,i)})}};function L(r,t){return new T(r,t)}/**
 * @description The code below is cursed. Look at it at your own risk.
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let N=class{constructor(t,e){h(this,"autoc4");this.autoc4=t,$("#klMatrixLines").on("input",function(){$("#klMatrixLinesOut").val(Number.parseInt(this.value))}),$("#klConwaySpeed").on("input",function(){$("#klConwaySpeedOut").val(Number.parseInt(this.value))}),$("#klConwayGenerations").on("input",function(){$("#klConwayGenerationsOut").val(Number.parseInt(this.value))}),$("#klSelect").change(function(){$(".klPane.active").removeClass("active"),$(`#${this.value}`).addClass("active")}),$("#klSet").click(()=>{switch($("#klSelect").val()){case"klEmpty":this.kl_empty();break;case"klChecker":this.kl_checker(Number.parseInt($("#klCheckerDelay").val()),$("#klCheckerColorA").val(),$("#klCheckerColorB").val());break;case"klPacman":this.kl_pacman();break;case"klText":this.kl_text(Number.parseInt($("#klTextDelay").val()),$("#klTextText").val());break;case"klOpenChaos":this.kl_open_chaos(Number.parseInt($("#klOCDelay").val()));break;case"klMatrix":this.kl_matrix(Number.parseInt($("#klMatrixLines").val()));break;case"klMood":this.kl_moodlight(Number.parseInt($("#klMoodMode").val()));break;case"klSine":this.kl_sine();break;case"klStrobe":this.kl_strobe();break;case"klFlood":this.kl_flood();break;case"klClock":this.kl_clock();break;case"klConway":this.kl_conway(Number.parseInt($("#klConwaySpeed").val()),Number.parseInt($("#klConwayGenerations").val()),$("#klConwayFill")[0].checked);break}}),$(".klPane.active").removeClass("active"),$(`#${$("#klSelect").val()}`).addClass("active"),$(".btn-floodit").click(function(){const o=this.textContent;if(!o)return;const s=Number.parseInt(o)-1;t.sendByte("kitchenlight/FloodIt/flood",s,!0)}),$("#klFlood").keypress(o=>{o.which<49||o.which>56||($(`#klFlood${o.which-48}`).click(),o.preventDefault())})}kl_change_screen(t){this.autoc4.sendData("kitchenlight/change_screen",t,!0)}kl_empty(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,0,!0),this.kl_change_screen(t)}kl_checker(t,e,o){const s=new ArrayBuffer(20),n=new DataView(s);n.setUint32(0,1,!0),n.setUint32(4,t,!0),n.setUint16(8,Number.parseInt(e.substr(1,2),16)*1023/255,!0),n.setUint16(10,Number.parseInt(e.substr(3,2),16)*1023/255,!0),n.setUint16(12,Number.parseInt(e.substr(5,2),16)*1023/255,!0),n.setUint16(14,Number.parseInt(o.substr(1,2),16)*1023/255,!0),n.setUint16(16,Number.parseInt(o.substr(3,2),16)*1023/255,!0),n.setUint16(18,Number.parseInt(o.substr(5,2),16)*1023/255,!0),this.kl_change_screen(s)}kl_matrix(t){const e=new ArrayBuffer(8),o=new DataView(e);o.setUint32(0,2,!0),o.setUint32(4,t,!0),this.kl_change_screen(e)}kl_moodlight(t){let e,o;t===1?(e=new ArrayBuffer(19),o=new DataView(e),o.setUint32(0,3,!0),o.setUint8(4,t),o.setUint32(5,1,!0),o.setUint32(9,10,!0),o.setUint32(13,1e4,!0),o.setUint16(17,30,!0),this.kl_change_screen(e)):(e=new ArrayBuffer(17),o=new DataView(e),o.setUint32(0,3,!0),o.setUint8(4,t),o.setUint32(5,1,!0),o.setUint32(9,10,!0),o.setUint32(13,1e4,!0),this.kl_change_screen(e))}kl_open_chaos(t){const e=new ArrayBuffer(8),o=new DataView(e);o.setUint32(0,4,!0),o.setUint32(4,t,!0),this.kl_change_screen(e)}kl_pacman(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,5,!0),this.kl_change_screen(t)}kl_sine(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,6,!0),this.kl_change_screen(t)}kl_strobe(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,7,!0),this.kl_change_screen(t)}kl_text(t,e){const o=new ArrayBuffer(8+e.length+1),s=new DataView(o);s.setUint32(0,8,!0),s.setUint32(4,t,!0);for(let n=0;n<e.length;n+=1)s.setUint8(8+n,e.charCodeAt(n)&255);s.setUint8(8+e.length,0),this.kl_change_screen(o)}kl_flood(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,9,!0),this.kl_change_screen(t)}kl_clock(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,11,!0),this.kl_change_screen(t)}kl_conway(t,e,o){const s=new ArrayBuffer(16),n=new DataView(s);n.setUint32(0,12,!0),n.setUint32(4,t,!0),n.setUint32(8,e,!0),o?n.setUint32(12,1,!0):n.setUint32(12,0,!0),this.kl_change_screen(s)}};function B(r,t){return new N(r,t)}/**
 * @description A module to provide simple toggle buttons for topics
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let E=class{constructor(t,e){h(this,"autoc4");h(this,"options");this.autoc4=t,this.options=e,this.initLightButtons()}initLightButtons(){const t=this;$("body").on("click",`[${this.options.topicDataAttribute}]`,function(){t.autoc4.sendByte(this.getAttribute(t.options.topicDataAttribute),this.classList.contains(t.options.onClass)?0:1,!0)})}onMessage(t,e){const o=$(`[${this.options.topicDataAttribute}="${e.destinationName}"]`);o&&e.payloadBytes[0]!==0?o.addClass(this.options.onClass):o.removeClass(this.options.onClass)}};function U(r,t){return new E(r,t)}/**
 * @description A simple module to add support for MPD bridge states
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let I=class{constructor(t,e){h(this,"options");this.options=e}onMessage(t,e){let o=document.querySelectorAll(`[${this.options.roleDataAttribute}=state][${this.options.topicDataAttribute}="${e.destinationName}"]`);for(const s of o)e.payloadString==="play"?(s.classList.add(this.options.playingClass),s.classList.remove(this.options.pausedClass,this.options.stoppedClass)):e.payloadString==="pause"?(s.classList.add(this.options.pausedClass),s.classList.remove(this.options.playingClass,this.options.stoppedClass)):e.payloadString==="stop"&&(s.classList.add(this.options.stoppedClass),s.classList.remove(this.options.playingClass,this.options.pausedClass));o=document.querySelectorAll(`[${this.options.roleDataAttribute}=song][${this.options.topicDataAttribute}="${e.destinationName}"]`);for(const s of o)s.innerText=e.payloadString}};function H(r,t){return new I(r,t)}var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var k={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(r){(function(t,e){r.exports?r.exports=e():t.Toastify=e()})(P,function(t){var e=function(i){return new e.lib.init(i)},o="1.12.0";e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:o,constructor:e,init:function(i){return i||(i={}),this.options={},this.toastElement=null,this.options.text=i.text||e.defaults.text,this.options.node=i.node||e.defaults.node,this.options.duration=i.duration===0?0:i.duration||e.defaults.duration,this.options.selector=i.selector||e.defaults.selector,this.options.callback=i.callback||e.defaults.callback,this.options.destination=i.destination||e.defaults.destination,this.options.newWindow=i.newWindow||e.defaults.newWindow,this.options.close=i.close||e.defaults.close,this.options.gravity=i.gravity==="bottom"?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=i.positionLeft||e.defaults.positionLeft,this.options.position=i.position||e.defaults.position,this.options.backgroundColor=i.backgroundColor||e.defaults.backgroundColor,this.options.avatar=i.avatar||e.defaults.avatar,this.options.className=i.className||e.defaults.className,this.options.stopOnFocus=i.stopOnFocus===void 0?e.defaults.stopOnFocus:i.stopOnFocus,this.options.onClick=i.onClick||e.defaults.onClick,this.options.offset=i.offset||e.defaults.offset,this.options.escapeMarkup=i.escapeMarkup!==void 0?i.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=i.ariaLive||e.defaults.ariaLive,this.options.style=i.style||e.defaults.style,i.backgroundColor&&(this.options.style.background=i.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var i=document.createElement("div");i.className="toastify on "+this.options.className,this.options.position?i.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(i.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):i.className+=" toastify-right",i.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var a in this.options.style)i.style[a]=this.options.style[a];if(this.options.ariaLive&&i.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)i.appendChild(this.options.node);else if(this.options.escapeMarkup?i.innerText=this.options.text:i.innerHTML=this.options.text,this.options.avatar!==""){var l=document.createElement("img");l.src=this.options.avatar,l.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?i.appendChild(l):i.insertAdjacentElement("afterbegin",l)}if(this.options.close===!0){var c=document.createElement("button");c.type="button",c.setAttribute("aria-label","Close"),c.className="toast-close",c.innerHTML="&#10006;",c.addEventListener("click",(function(b){b.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var u=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&u>360?i.insertAdjacentElement("afterbegin",c):i.appendChild(c)}if(this.options.stopOnFocus&&this.options.duration>0){var d=this;i.addEventListener("mouseover",function(b){window.clearTimeout(i.timeOutValue)}),i.addEventListener("mouseleave",function(){i.timeOutValue=window.setTimeout(function(){d.removeElement(i)},d.options.duration)})}if(typeof this.options.destination<"u"&&i.addEventListener("click",(function(b){b.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&i.addEventListener("click",(function(b){b.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var p=s("x",this.options),g=s("y",this.options),y=this.options.position=="left"?p:"-"+p,v=this.options.gravity=="toastify-top"?g:"-"+g;i.style.transform="translate("+y+","+v+")"}return i},showToast:function(){this.toastElement=this.buildToast();var i;if(typeof this.options.selector=="string"?i=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?i=this.options.selector:i=document.body,!i)throw"Root element is not defined";var a=e.defaults.oldestFirst?i.firstChild:i.lastChild;return i.insertBefore(this.toastElement,a),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(i){i.className=i.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),i.parentNode&&i.parentNode.removeChild(i),this.options.callback.call(i),e.reposition()}).bind(this),400)}},e.reposition=function(){for(var i={top:15,bottom:15},a={top:15,bottom:15},l={top:15,bottom:15},c=document.getElementsByClassName("toastify"),u,d=0;d<c.length;d++){n(c[d],"toastify-top")===!0?u="toastify-top":u="toastify-bottom";var p=c[d].offsetHeight;u=u.substr(9,u.length-1);var g=15,y=window.innerWidth>0?window.innerWidth:screen.width;y<=360?(c[d].style[u]=l[u]+"px",l[u]+=p+g):n(c[d],"toastify-left")===!0?(c[d].style[u]=i[u]+"px",i[u]+=p+g):(c[d].style[u]=a[u]+"px",a[u]+=p+g)}return this};function s(i,a){return a.offset[i]?isNaN(a.offset[i])?a.offset[i]:a.offset[i]+"px":"0px"}function n(i,a){return!i||typeof a!="string"?!1:!!(i.className&&i.className.trim().split(/\s+/gi).indexOf(a)>-1)}return e.lib.init.prototype=e.lib,e})})(k);var R=k.exports;const V=O(R);/**
 * @description A simple module for defining data attributes for elements
 * such that when there is any user interaction with the element an MQTT
 * message is sent.
 * @author Qb
 * @copyright Chaos Computer Club Cologne 2019-2024
 * @license MIT
 */let F=class{constructor(t,e){h(this,"options");this.options=e}onMessage(t,e){const o=e.payloadString;let s=this.options.textTemplate;this.options.payloadStringPlaceholder&&(s=s.split(this.options.payloadStringPlaceholder).join(o)),V({text:s,duration:this.options.hideDelayMs,gravity:"bottom",position:"center",style:{border:"2px solid #888",borderRadius:"6px",background:"inherit",color:"inherit",boxShadow:"none"}}).showToast()}};function q(r,t){return new F(r,t)}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let G=class{constructor(t,e){$("body").on("click",`[${e.topicDataAttribute}]`,function(){const o=$(this);t.sendData(o.attr(`[${e.topicDataAttribute}]`),o.attr("data-preset-message")||"")})}create_button(t,e){return $("<button>",{type:"button",class:"btn btn-preset","data-preset-topic":t==="global"?"preset/set":`preset/${t}/set`,"data-preset-message":e}).text(e)}onMessage(t,e){let o;try{o=JSON.parse(e.payloadString)}catch{console.log("module/presets: Invalid JSON received");return}let s=e.destinationName.split("/")[1];if(s==="list"){s="global";for(const i of document.querySelectorAll("div.preset-pane[data-room]")){const a=i.querySelector(".preset-pane-global-marker");if(!a){console.warn("module/presets: No global marker found for preset pane",i);continue}const l=i.getAttribute("data-room");for(const c of o)this.create_button(l,c).insertBefore(a)}}const n=document.querySelector(`div.preset-pane[data-room="${s}"] > .preset-pane-room-marker`);if(!n){console.warn(`module/presets: No room marker found for room: ${s}`);return}for(const i of o)this.create_button(s,i).insertBefore(n)}onConnect(t,e){$("div.preset-pane[data-room] > [data-preset-topic]").remove()}};function j(r,t){return new G(r,t)}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let Q=class{constructor(t,e){h(this,"options");this.options=e}onMessage(t,e){const o=document.querySelectorAll(this.options.target);e.payloadBytes[0]?o.forEach(s=>{s.classList.remove(this.options.closedClass,this.options.disconnectedClass),s.classList.add(this.options.openClass)}):o.forEach(s=>{s.classList.remove(this.options.openClass,this.options.disconnectedClass),s.classList.add(this.options.closedClass)})}onConnectionFailure(t,e){document.querySelectorAll(this.options.target).forEach(o=>{o.classList.remove(this.options.openClass,this.options.closedClass),o.classList.add(this.options.disconnectedClass)})}};function W(r,t){return new Q(r,t)}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */function z(r,t){const e=r.split("/"),o=t.split("/");for(let s=0;s<e.length;s++){const n=e[s];if(n==="#")return!0;if(n!==o[s]&&n!=="+")return!1}return e.length===o.length}function m(r){return`0${r}`.slice(-2)}function K(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}function Y(r,t){return r.replace(/yyyy/,t.getFullYear().toString()).replace(/yy/,(t.getFullYear()%100).toString()).replace(/MM/,m(t.getMonth()+1)).replace(/M/,(t.getMonth()+1).toString()).replace(/dd/,m(t.getDate())).replace(/d/,t.getDate().toString()).replace(/HH/,m(t.getHours())).replace(/H/,t.getHours().toString()).replace(/mm/,m(t.getMinutes())).replace(/m/,t.getMinutes().toString()).replace(/ss/,m(t.getSeconds())).replace(/s/,t.getSeconds().toString())}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */let J=class{constructor(t,e){h(this,"options");this.options=e,this.options.defaultToCurrentTime&&this.setTime(new Date)}onMessage(t,e){if(e.payloadBytes.byteLength<7){console.warn(`Received invalid time payload on topic "${e.destinationName}".`);return}const o=e.payloadBytes,s=new Date,n=new Date(s.getFullYear()-s.getFullYear()%100+o[7],o[5]-1,o[6],o[0],o[1],o[2]);this.setTime(n)}setTime(t){const e=document.querySelectorAll(this.options.targetSelector);for(const o of e)o.textContent=Y(o.getAttribute(this.options.templateDataAttribute)||"yyyy-MM-ddZHH-mm-ss",t)}};function X(r,t){return new J(r,t)}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 */class Z{onMessage(t,e){const o=$(".box-window").filter(`[data-topic="${e.destinationName}"]`);o&&e.payloadBytes[0]!==0?o.addClass("open"):o.removeClass("open")}}function tt(r,t){return new Z}/**
 * @copyright Chaos Computer Club Cologne 2014-2020
 * @license MIT
 * @requires utils
 */$(()=>{fetch("./config.json",{method:"GET",headers:{"Content-Type":"application/json"}}).then(r=>r.json()).then(r=>{var t;(t=r.debug)!=null&&t.configLoaded&&console.debug("Config loaded successfully",r),globalThis.autoc4=new et(r)}).catch(r=>{console.error("Couldn't load config.json",r)})});class et{constructor(t){h(this,"config");h(this,"modules",[]);h(this,"client");h(this,"_moduleTypes",{});this.config=t,this.client=new Paho.MQTT.Client(t.server||window.location.hostname,t.port||9e3,(t.clientIdPrefix||"shiny_")+K()),this.client.onMessageArrived=this.onMessage.bind(this),this.client.onConnectionLost=this.onConnectionFailure.bind(this),this.registerModuleType("interactivity",L),this.registerModuleType("light",U),this.registerModuleType("dmx",D),this.registerModuleType("state",W),this.registerModuleType("heartbeat",x),this.registerModuleType("windows",tt),this.registerModuleType("presets",j),this.registerModuleType("kitchenlight",B),this.registerModuleType("music",H),this.registerModuleType("notify",q),this.registerModuleType("time",X),this.registerModuleType("cyber",_),this.loadModules(),this.connect()}loadModules(){var t;for(const e of this.config.modules)try{e.instance=this.moduleConfigToModule(e),this.modules.push(e.instance),(t=this.config.debug)!=null&&t.moduleLoaded&&console.debug(`Successfully initialized module of type "${e.type}".`,e)}catch(o){console.error("An error occured while initializing a module."),console.error("Module Type: ",e.type),console.error(o)}}connect(){this.client.connect({onSuccess:this.onConnect.bind(this),onFailure:this.client.onConnectionLost,mqttVersion:3})}onMessage(t){var e,o,s,n;(e=this.config.debug)!=null&&e.message&&console.debug("MQTT message received:",t);for(const i of this.config.modules)try{(o=i.subscribe)!=null&&o.some(a=>z(a,t.destinationName))&&((n=(s=i.instance).onMessage)==null||n.call(s,this,t))}catch(a){console.error("An error occured while processing a message."),console.error("Module: ",i.instance),console.error(a)}}onConnect(t){var e,o;(e=this.config.debug)!=null&&e.connect&&console.debug("MQTT connection successfull.",t);for(const s of this.config.modules)if(s.subscribe)for(const n of s.subscribe)this.client.subscribe(n);for(const s of this.modules)try{(o=s.onConnect)==null||o.call(s,this,t)}catch(n){console.error("An error occured while handling disconnect."),console.error("Module: ",s),console.error(n)}}onConnectionFailure(t){var e,o;(e=this.config.debug)!=null&&e.disconnect&&console.warn("MQTT connection failure, retrying in 5 seconds..",t),setTimeout(s=>{s.connect()},5e3,this);for(const s of this.modules)try{(o=s.onConnectionFailure)==null||o.call(s,this,t)}catch(n){console.error("An error occured while handling disconnect."),console.error("Module: ",s),console.error(n)}}sendData(t,e,o=!1){var n;const s=new Paho.MQTT.Message(e);s.destinationName=t,s.retained=o,this.client.send(s),(n=this.config.debug)!=null&&n.sentMessage&&console.debug("Sent MQTT Message:",s)}sendByte(t,e,o=!1){this.sendData(t,new Uint8Array(e===void 0?[0]:[e]),o)}registerModuleType(t,e){this._moduleTypes[t]=e}moduleConfigToModule(t){if(t.type in this._moduleTypes)return this._moduleTypes[t.type](this,t.options);throw new Error(`Unknown module type: ${t.type}`)}}
