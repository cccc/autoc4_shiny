import Color from"../color.js";class AutoC4DMX{init(t,i){return this.options=i,this.autoc4=t,this.initColorSelection(),this.initPoweroff(),this.initBrightness(),this.initFade(),this.initRandom(),this.initSound(),this}onMessage(t,i){let o=i.destinationName.split("/");if(o.length<3)return;let e=i.payloadBytes;if(e.length<3)return;let r=o[1],a=o[2],s=this.getPickers(r,"light",a);if(!s.length)return;let n=Color.fromRGB({r:e[0],g:e[1],b:e[2]}).toHexString();for(let t of s)t.value=n;this.updateMasterForRoom(r)}updateMasterForRoom(t){let i;for(let o of this.getPickers(t))void 0===i?i=o.value:i!=o.value&&(i="#000000");for(let o of this.getPickers(t,"master"))o.value=i}initColorSelection(){const t=this;$("body").on("change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=light],[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=master]`,(function(){let i=Color.fromHexString(this.value),o=+this.getAttribute(t.options.channelsDataAttribute)||7,e=this.getAttribute(t.options.roomDataAttribute),r=this.getAttribute(t.options.lightDataAttribute);if(!r){if("master"!==this.getAttribute(t.options.roleDataAttribute))return;r="master"}t.setLightColor(e,r,o,i)}))}initPoweroff(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=poweroff]`,(function(){let i=Color.fromRGB({r:0,g:0,b:0}),o=+this.getAttribute(t.options.channelsDataAttribute)||7,e=this.getAttribute(t.options.roomDataAttribute),r=this.getAttribute(t.options.lightDataAttribute);r||(r="master"),t.setLightColor(e,r,o,i)}))}initBrightness(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=brightness][${this.options.valueDataAttribute}]`,(function(){let i=+this.getAttribute(t.options.valueDataAttribute),o=this.getAttribute(t.options.roomDataAttribute);for(let e of t.getPickers(o)){let r=+e.getAttribute(t.options.channelsDataAttribute)||7,a=e.getAttribute(t.options.lightDataAttribute),s=Color.fromHexString(e.value);s.v=Math.min(Math.max(0,s.v*i),1),t.setLightColor(o,a,r,s)}}))}initRandom(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=random][${this.options.valueDataAttribute}]`,(function(){let i=+$(this.getAttribute(t.options.valueDataAttribute)).val(),o=$(this.getAttribute(t.options.roomDataAttribute)).val();for(let e of t.getPickers(o)){let r=+e.getAttribute(t.options.channelsDataAttribute)||7,a=e.getAttribute(t.options.lightDataAttribute),s=Color.fromHSV({h:Math.random(),s:1,v:i});t.setLightColor(o,a,r,s)}}))}initFade(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=fade][${this.options.valueDataAttribute}]`,(function(){let i=+$(this.getAttribute(t.options.valueDataAttribute)).val(),o=$(this.getAttribute(t.options.roomDataAttribute)).val();for(let e of t.getPickers(o)){if(7!=(+e.getAttribute(t.options.channelsDataAttribute)||7))continue;let r=e.getAttribute(t.options.lightDataAttribute);t.sendLightData(o,r,new Uint8Array([0,0,0,0,i,140,255]))}}))}initSound(){const t=this;$("body").on("click change",`[${this.options.roomDataAttribute}][${this.options.roleDataAttribute}=sound][${this.options.valueDataAttribute}]`,(function(){let i=+$(this.getAttribute(t.options.valueDataAttribute)).val(),o=$(this.getAttribute(t.options.roomDataAttribute)).val();for(let e of t.getPickers(o)){if(7!=(+e.getAttribute(t.options.channelsDataAttribute)||7))continue;let r=e.getAttribute(t.options.lightDataAttribute);t.sendLightData(o,r,new Uint8Array([0,0,0,0,i,246,255]))}}))}setLightColor(t,i,o,e){3==o?this.sendLightData(t,i,new Uint8Array([e.r,e.g,e.b,255])):this.sendLightData(t,i,new Uint8Array([e.r,e.g,e.b,0,0,0,255]))}sendLightData(t,i,o){this.autoc4.sendData("dmx/"+t+"/"+i,o,!0),this.updateMasterForRoom(t)}getPickers(t,i="light",o){let e;return e=void 0===o?document.querySelectorAll(`[${this.options.roleDataAttribute}="${i}"]`+`[${this.options.roomDataAttribute}="${t}"]`):document.querySelectorAll(`[${this.options.roleDataAttribute}="${i}"]`+`[${this.options.roomDataAttribute}="${t}"]`+`[${this.options.lightDataAttribute}="${o}"]`),Array.prototype.slice.apply(e)}onConnect(t,i){}onConnectionFailure(t,i){}}export default t=>t.registerModuleType("dmx",()=>new AutoC4DMX);
//# sourceMappingURL=dmx.min.js.map
